        <h2><%= @exam.name %></h2>
        <br style="clear: both;">
        <section class="carousel" aria-label="Gallery">
            <ol class="carousel__viewport">
                <li id="carousel__slide0" tabindex="0" class="carousel__slide">
                    <div class="carousel__snapper">
                        <section class="question">
                            <h3 class="h3"><%= @exam.description %></h3>
                            <table align="center" id="overview">
                                <tr>
                                    <td><strong>Questions</strong></td><td align="center"><%= @exam.questions %> / <%= Question.where(:exam => @exam.id).size %></td>
                                </tr>
                                <tr>
                                    <td><strong>Shuffle Questions</strong></td><td align="center"><%= @exam.shuffle_questions %></td>
                                </tr>
                                <tr>
                                    <td><strong>Shuffle Answers</strong></td><td align="center"><%= @exam.shuffle_answers %></td>
                                </tr>
                                <tr>
                                    <td><strong>Hints</strong></td><td align="center"><%= @exam.hints %></td>
                                </tr>
                                <tr>
                                    <td><strong>Checks</strong></td><td align="center"><%= @exam.checks %></td>
                                </tr>
                            </table>
                            <br style="clear: both;" />
                            <br style="clear: both;" />
                            <a id="toggle" class="center pushdown margindown begin" href="#carousel__slide1">Begin Exam</a>
                            <br style="clear: both;" />
                            <br style="clear: both;" />
                        </section>
                    </div>
                </li>
            	<% x = 0 %>
            	<% @questions.each_with_index do |question, index| %>
                <li id="carousel__slide<%= index + 1 %>" tabindex="0" class="carousel__slide">
                    <div class="carousel__snapper">
                        <% if index > 0 %><a href="#carousel__slide<%= index %>" class="button left">PREVIOUS</a><% end %>
                        <% if index + 1 < @questions.size %><a href="#carousel__slide<%= index + 2 %>" class="button right">NEXT</a><% end %>
                        <br style="clear: both;" />
						<section class="question">
                            <form>
                                <fieldset>
                                    <legend>Question #<%= index + 1 %></legend>
                                    <span class="q_text">
                                    	<% question.q_text = question.q_text.gsub('[', '<').gsub(']', '>') %>
                                    	<%= question.q_text.html_safe %>
                                    </span> <%
                                    options=[]
                                    correct=[]
                                    options.clear
                                    correct.clear
                                    if @exam.shuffle_answers
                                        options = options.shuffle
                                    end
                                    
									if question.q_answer001_correct
                                    	correct[x] = question.q_answer001
                                    end
                                    if question.q_answer001_active
                                    	options[x] = question.q_answer001
                                    	x += 1
                                    end
									if question.q_answer002_correct
                                    	correct[x] = question.q_answer002
                                    end
                                    if question.q_answer002_active
                                    	options[x] = question.q_answer002
                                    	x += 1
                                    end
									if question.q_answer003_correct
                                    	correct[x] = question.q_answer003
                                    end
                                    if question.q_answer003_active
                                    	options[x] = question.q_answer003
                                    	x += 1
                                    end
									if question.q_answer004_correct
                                    	correct[x] = question.q_answer004
                                    end
                                    if question.q_answer004_active
                                    	options[x] = question.q_answer004
                                    	x += 1
                                    end
									if question.q_answer005_correct
                                    	correct[x] = question.q_answer005
                                    end
                                    if question.q_answer005_active
                                    	options[x] = question.q_answer005
                                    	x += 1
                                    end
									if question.q_answer006_correct
                                    	correct[x] = question.q_answer006
                                    end
                                    if question.q_answer006_active
                                    	options[x] = question.q_answer006
                                    	x += 1
                                    end
									if question.q_answer007_correct
                                    	correct[x] = question.q_answer007
                                    end
                                    if question.q_answer007_active
                                    	options[x] = question.q_answer007
                                    	x += 1
                                    end
									if question.q_answer008_correct
                                    	correct[x] = question.q_answer008
                                    end
                                    if question.q_answer008_active
                                    	options[x] = question.q_answer008
                                    	x += 1
                                    end
									if question.q_answer009_correct
                                    	correct[x] = question.q_answer009
                                    end
                                    if question.q_answer009_active
                                    	options[x] = question.q_answer009
                                    	x += 1
                                    end
									if question.q_answer010_correct
                                    	correct[x] = question.q_answer010
                                    end
                                    if question.q_answer010_active
                                    	options[x] = question.q_answer010
                                    	x += 1
                                    end
                                    %>
                                    <ul class="options">
                                    <% options.each_with_index do |option, index| %>
                                        <% if option != nil %>
                                        <li>
                                            <input type="<%= question.q_type %>" id="00<%= x + index %>" name="question<%= x %>" />
                                            <% if question.q_type != "text" %>
                                            <label for="00<%= x + index %>">
                                            	<span class="text"<% if options[index] == correct[index] %> id="hint_0<%= x + index %>"<% end %>>
                                            		<%= option %>
                                            	</span>
                                            </label>
                                            <% end %>
                                        </li>
                                        <% end %>
                                    <% end %>
                                    </ul>
                                </fieldset>
                                <% if @exam.checks %><a href="#" class="button" onclick="checkQuestion<%= index + 1 %>()">CHECK</a><% end %>
                                <span id="Q<%= index + 1 %>_info"></span>
                                <% if @exam.hints %><a href="#" class="button right pushright" id="hintbutton_<%= index + 1 %>" onclick="hintQuestion<%= index + 1 %>()">HINT</a><% end %>
                                <% if index + 1 == @questions.size %><a class="center pushdown margindown finish" onclick="finish_exam();" href="#carousel__slide1000">FINISH</a><% end %>
                            </form>
                            <script>
                            <% if question.q_type == "checkbox" || question.q_type == "radio" %>
                                function checkQuestion<%= index + 1 %>() {
                                  var Q<%= index + 1 %>_info = document.getElementById("Q<%= index + 1 %>_info");

                                  if (
	                              <% options.each_with_index do |option, index| %>
	                                  <% if options[index] == correct[index] %>
	                                  	<% if option != nil %>
	                                  	document.getElementById("00<%= x + index %>").checked == true<% if index + 1 < correct.length %> &&<% end %>
	                                    <% end %>
	                                  <% end %>
	                              <% end %>
	                              ) {
	                                    Q<%= index + 1 %>_info.innerHTML = "CORRECT!";
	                                    Q<%= index + 1 %>_info.className = "correct";
                                        Q<%= index + 1 %>_result = "correct"
                                  } else {
	                                    Q<%= index + 1 %>_info.innerHTML = "FALSE!";
	                                    Q<%= index + 1 %>_info.className = "false";
                                        Q<%= index + 1 %>_result = "false"
                                  }
                                <% if question.q_type == "checkbox" %>
                                <% newindex = 0 %>
                                <% incorrect = options.compact.count - correct.compact.count %>
                                  if ( 
	                              <% options.each_with_index do |option, index| %>
	                                  <% if options[index] != correct[index] %>
                                        <% newindex += 1 %>
	                                  	document.getElementById("00<%= x + index %>").checked == true<% if newindex < incorrect %> ||<% end %>
	                                  <% end %>
	                              <% end %>
	                              ) {
	                                    Q<%= index + 1 %>_info.innerHTML = "FALSE!";
	                                    Q<%= index + 1 %>_info.className = "false";
                                        Q<%= index + 1 %>_result = "false"
	                              }
                                <% end %>
                                }
                                function hintQuestion<%= index + 1 %>() {
	                              <% options.each_with_index do |option, index| %>
	                                  <% if options[index] == correct[index] %>
	                                  	<% if option != nil %>
	                                  	document.getElementById("hint_0<%= x + index %>").classList.toggle("hint");
	                                    <% end %>
	                                  <% end %>
	                              <% end %>
                                }
                             <% else %>
                             function checkQuestion<%= index + 1 %>() {
                             	if (document.getElementsByName("question<%= x %>")[0].value == "<%= question.q_answer001 %>"){
	                                    Q<%= index + 1 %>_info.innerHTML = "CORRECT!";
	                                    Q<%= index + 1 %>_info.className = "correct";
                                        Q<%= index + 1 %>_result = "correct"
                                  } else {
	                                    Q<%= index + 1 %>_info.innerHTML = "FALSE!";
	                                    Q<%= index + 1 %>_info.className = "false";
                                        Q<%= index + 1 %>_result = "false"
                                  }
                             }
                             function hintQuestion<%= index + 1 %>() {
                             	document.getElementsByName("question<%= x %>")[0].value = "<%= question.q_answer001 %>"
                             }
	                        <% end %>
                            </script>
                        </section>
                    </div>
                </li>
            	<% end %>
                <li id="carousel__slide1000" tabindex="0" class="carousel__slide">
                    <div class="carousel__snapper">
                        <section class="question">
                            <h3 class="h3">Result: <span id="percent"></span>%</h3>
                            <table align="center">
                                <tr>
                                    <th align="center">#</th>
                                    <th align="center">Question</th>
                                    <th>Result</th>
                                </tr>
                                <% @questions.each_with_index do |question, index| %>
                                <tr class="<%= cycle('even', 'odd') -%>">
                                    <td align="center">
                                        <strong>#<%= index + 1 %></strong>
                                    </td>
                                    <td align="left">
                                        <a href="#carousel__slide<%= index + 1 %>"><%= strip_tags(question.q_text.html_safe.truncate(70)) %></a>
                                    </td>
                                    <td class="result<%= index + 1 %>"></td>
                                </tr>
                                <% end %>
                            </table>
                        </section>
                    </div>
                </li>
            </ol>
            <aside class="carousel__navigation invisible">
                <ol class="carousel__navigation-list">
                	<% @questions.each_with_index do |question, index| %>
                    <li class="carousel__navigation-item">
                        <a class="button" href="#carousel__slide<%= index + 1 %>">Q<%= index + 1 %></a>
                    </li>
                    <% end %>
                </ol>
            </aside>
        </section>
        <script>

            if (document.fullscreenEnabled) {
                var btn = document.getElementById("toggle");
                var nav = document.getElementsByClassName("invisible")[0];
                btn.addEventListener("click", function (event) {
                    nav.classList.toggle("invisible");
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                    } else {
                        document.exitFullscreen();
                    }
                }, false);
                document.addEventListener("fullscreenchange", function (event) {
                    console.log(event);
                    if (!document.fullscreenElement) {
                        btn.innerText = "Activate fullscreen";
                    } else {
                        btn.innerText = "Exit fullscreen";
                    }
                });
                document.addEventListener("fullscreenerror", function (event) {
                    console.log(event);
                });
            }

            function finish_exam() {
                correct = 0;
                incorrect = 0;
                percent = 0;
                <% @questions.each_with_index do |question, index| %>
                checkQuestion<%= index + 1 %>();
                var cell<%= index + 1 %> = document.getElementsByClassName("result<%= index + 1 %>")[0];
                cell<%= index + 1 %>.innerHTML = Q<%= index + 1 %>_result;
                if (Q<%= index + 1 %>_result == "correct") {correct+=1}
                if (Q<%= index + 1 %>_result == "false") {incorrect+=1}
                <% end %>
                percent = ((correct / (correct + incorrect)) * 100).toFixed(2);
                var result = document.getElementById("percent");
                result.innerHTML = percent;

                var nav = document.getElementsByClassName("carousel__navigation")[0];
                nav.classList.toggle("invisible");
            }
        </script>
